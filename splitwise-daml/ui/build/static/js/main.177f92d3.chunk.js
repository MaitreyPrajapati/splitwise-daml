(this["webpackJsonpsplitwise-daml"]=this["webpackJsonpsplitwise-daml"]||[]).push([[0],{291:function(e,t,n){},298:function(e,t){},300:function(e,t){},31:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(390);t.User=r,t.packageId="176e94e6dc181f08516d3fa9a9052a345ef6315fbd4524b494acf85bf107caf6"},311:function(e,t){},313:function(e,t){},340:function(e,t){},342:function(e,t){},343:function(e,t){},348:function(e,t){},350:function(e,t){},369:function(e,t){},381:function(e,t){},384:function(e,t){},390:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(391))},391:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(95),a=n(142),c=(n(86),n(392));t.Transaction={templateId:"176e94e6dc181f08516d3fa9a9052a345ef6315fbd4524b494acf85bf107caf6:User:Transaction",keyDecoder:a.lazyMemo((function(){return r.constant(void 0)})),keyEncode:function(){throw"EncodeError"},decoder:a.lazyMemo((function(){return r.object({lender:a.Party.decoder,borrower:a.Party.decoder,amount:a.Numeric(2).decoder})})),encode:function(e){return{lender:a.Party.encode(e.lender),borrower:a.Party.encode(e.borrower),amount:a.Numeric(2).encode(e.amount)}},Archive:{template:function(){return t.Transaction},choiceName:"Archive",argumentDecoder:a.lazyMemo((function(){return c.DA.Internal.Template.Archive.decoder})),argumentEncode:function(e){return c.DA.Internal.Template.Archive.encode(e)},resultDecoder:a.lazyMemo((function(){return a.Unit.decoder})),resultEncode:function(e){return a.Unit.encode(e)}}},a.registerTemplate(t.Transaction),t.MakeTransaction={decoder:a.lazyMemo((function(){return r.object({lender:a.Party.decoder,amount:a.Numeric(2).decoder})})),encode:function(e){return{lender:a.Party.encode(e.lender),amount:a.Numeric(2).encode(e.amount)}}},t.Follow={decoder:a.lazyMemo((function(){return r.object({userToFollow:a.Party.decoder})})),encode:function(e){return{userToFollow:a.Party.encode(e.userToFollow)}}},t.User={templateId:"176e94e6dc181f08516d3fa9a9052a345ef6315fbd4524b494acf85bf107caf6:User:User",keyDecoder:a.lazyMemo((function(){return a.lazyMemo((function(){return a.Party.decoder}))})),keyEncode:function(e){return a.Party.encode(e)},decoder:a.lazyMemo((function(){return r.object({username:a.Party.decoder,following:a.List(a.Party).decoder})})),encode:function(e){return{username:a.Party.encode(e.username),following:a.List(a.Party).encode(e.following)}},Archive:{template:function(){return t.User},choiceName:"Archive",argumentDecoder:a.lazyMemo((function(){return c.DA.Internal.Template.Archive.decoder})),argumentEncode:function(e){return c.DA.Internal.Template.Archive.encode(e)},resultDecoder:a.lazyMemo((function(){return a.Unit.decoder})),resultEncode:function(e){return a.Unit.encode(e)}},Follow:{template:function(){return t.User},choiceName:"Follow",argumentDecoder:a.lazyMemo((function(){return t.Follow.decoder})),argumentEncode:function(e){return t.Follow.encode(e)},resultDecoder:a.lazyMemo((function(){return a.ContractId(t.User).decoder})),resultEncode:function(e){return a.ContractId(t.User).encode(e)}},MakeTransaction:{template:function(){return t.User},choiceName:"MakeTransaction",argumentDecoder:a.lazyMemo((function(){return t.MakeTransaction.decoder})),argumentEncode:function(e){return t.MakeTransaction.encode(e)},resultDecoder:a.lazyMemo((function(){return a.ContractId(t.Transaction).decoder})),resultEncode:function(e){return a.ContractId(t.Transaction).encode(e)}}},a.registerTemplate(t.User)},392:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(393);t.DA=r,t.packageId="d14e08374fc7197d6a0de468c968ae8ba3aadbf9315476fd39071831f5923662"},393:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(394);t.Internal=r},394:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(395);t.Template=r},395:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(396))},396:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(95),a=n(142);n(86);t.Archive={decoder:a.lazyMemo((function(){return r.object({})})),encode:function(e){return{}}}},530:function(e,t,n){"use strict";n.r(t);var r,a,c=n(0),o=n.n(c),s=n(55),i=n.n(s),u=(n(290),n(291),n(34)),l=n(25),d=n.n(l),j=n(42),f=n(544),m=n(545),b=n(166),h=n(540),p=n(546),O=n(542),x=n(259);!function(e){e[e.DEV=0]="DEV",e[e.PROD_DABL=1]="PROD_DABL",e[e.PROD_OTHER=2]="PROD_OTHER"}(a||(a={}));var v=window.location.hostname.endsWith(".projectdabl.com")?a.PROD_DABL:a.PROD_OTHER,y=v===a.PROD_DABL?window.location.hostname.split(".")[0]:null!==(r="splitwise-daml-sandbox")?r:"splitwise-daml-sandbox",g=v===a.PROD_DABL?"https://api.projectdabl.com/data/".concat(y,"/"):void 0;var w=function(e){return{party:e,token:function(e){var t={"https://daml.com/ledger-api":{ledgerId:y,applicationId:"splitwise-daml",actAs:[e]}};return Object(x.encode)(t,"secret","HS256")}(e),ledgerId:y}},k=n(86),P=n.n(k),D=n(31),U=n(5),M=function(e){var t=e.onLogin,n=o.a.useState(""),r=Object(u.a)(n,2),s=r[0],i=r[1],l=Object(c.useCallback)(function(){var e=Object(j.a)(d.a.mark((function e(n){var r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new P.a({token:n.token,httpBaseUrl:g}),e.next=4,r.fetchByKey(D.User.User,n.party);case 4:if(null!==e.sent){e.next=10;break}return a={username:n.party,following:[]},e.next=9,r.create(D.User.User,a);case 9:e.sent;case 10:t(n),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),alert("Unknown error:\n".concat(e.t0));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),[t]),x=function(){var e=Object(j.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=w(s),e.next=4,l(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){var e=new URL(window.location.toString()),t=e.searchParams.get("token");if(null!==t){var n=e.searchParams.get("party");if(null===n)throw Error("When 'token' is passed via URL, 'party' must be passed too.");e.search="",window.history.replaceState(window.history.state,"",e.toString()),l({token:t,party:n,ledgerId:y})}}),[l]),Object(U.jsx)(f.a,{textAlign:"center",style:{height:"100vh"},verticalAlign:"middle",children:Object(U.jsxs)(f.a.Column,{style:{maxWidth:450},children:[Object(U.jsx)(m.a,{as:"h1",textAlign:"center",size:"huge",style:{color:"#223668"},children:Object(U.jsxs)(m.a.Content,{children:["Create",Object(U.jsx)(b.a,{as:"a",href:"https://www.daml.com/",target:"_blank",src:"/daml.svg",alt:"Daml Logo",spaced:!0,size:"small",verticalAlign:"middle"}),"App"]})}),Object(U.jsx)(h.a,{size:"large",className:"test-select-login-screen",children:Object(U.jsx)(p.a,{children:v!==a.PROD_DABL?Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(h.a.Input,{fluid:!0,icon:"user",iconPosition:"left",placeholder:"Username",value:s,className:"test-select-username-field",onChange:function(e){return i(e.currentTarget.value)}}),Object(U.jsx)(O.a,{primary:!0,fluid:!0,className:"test-select-login-button",onClick:x,children:"Log in"})]}):Object(U.jsx)(O.a,{primary:!0,fluid:!0,onClick:function(){window.location.assign("https://login.projectdabl.com/auth/login?ledgerId=".concat(y))},children:"Log in with DABL"})})})]})})},C=n(543),I=n(538),T=n(47),A=n(539),_=n(24),L=n.n(_),N=n(89),S=n(547),E=function(e){var t=e.users,n=e.onFollow;return Object(U.jsx)(S.a,{divided:!0,relaxed:!0,children:Object(N.a)(t).sort((function(e,t){return e.username.localeCompare(t.username)})).map((function(e){return Object(U.jsxs)(S.a.Item,{children:[Object(U.jsx)(S.a.Icon,{name:"user"}),Object(U.jsxs)(S.a.Content,{children:[Object(U.jsx)(S.a.Content,{floated:"right",children:Object(U.jsx)(T.a,{name:"add user",link:!0,className:"test-select-add-user-icon",onClick:function(){return n(e.username)}})}),Object(U.jsx)(S.a.Header,{className:"test-select-user-in-network",children:e.username})]}),Object(U.jsx)(S.a.List,{children:Object(N.a)(e.following).sort((function(e,t){return e.localeCompare(t)})).map((function(e){return Object(U.jsxs)(S.a.Item,{children:[Object(U.jsx)(S.a.Content,{floated:"right",children:Object(U.jsx)(T.a,{name:"add user",link:!0,className:"test-select-add-user-following-icon",onClick:function(){return n(e)}})}),Object(U.jsx)(S.a.Icon,{name:"user outline"}),Object(U.jsx)(S.a.Content,{children:Object(U.jsx)(S.a.Header,{children:e})})]},e)}))})]},e.username)}))})},z=function(e){var t=e.parties,n=e.onAddParty,r=o.a.useState(""),a=Object(u.a)(r,2),c=a[0],s=a[1],i=o.a.useState(!1),l=Object(u.a)(i,2),f=l[0],m=l[1],b=function(){var e=Object(j.a)(d.a.mark((function e(t){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&t.preventDefault(),m(!0),e.next=4,n(c);case 4:r=e.sent,m(!1),r&&s("");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(U.jsxs)(S.a,{relaxed:!0,children:[Object(N.a)(t).sort((function(e,t){return e.localeCompare(t)})).map((function(e){return Object(U.jsxs)(S.a.Item,{children:[Object(U.jsx)(S.a.Icon,{name:"user outline"}),Object(U.jsx)(S.a.Content,{children:Object(U.jsx)(S.a.Header,{className:"test-select-following",children:e})})]},e)})),Object(U.jsx)("br",{}),Object(U.jsxs)(h.a,{onSubmit:b,children:[Object(U.jsx)(h.a.Input,{fluid:!0,readOnly:f,loading:f,className:"test-select-follow-input",placeholder:"Username to follow",value:c,onChange:function(e){return s(e.currentTarget.value)}}),Object(U.jsx)(O.a,{type:"submit",className:"test-select-follow-button",children:"Follow"})]})]})},F=n(165),R=function(){var e,t,n=Object(_.useStreamQuery)(D.User.Transaction),r=Object(_.useParty)(),a=null===(e=Object(_.useStreamFetchByKeys)(D.User.User,(function(){return[r]}),[r]).contracts[0])||void 0===e?void 0:e.payload,c=0;return Object(U.jsxs)(S.a,{relaxed:!0,children:[n.contracts.map((function(e){var t=e.payload,n=t.lender,r=t.borrower,o=t.amount;return c+=a&&n===a.username?parseFloat(o):-parseFloat(o),Object(U.jsxs)(F.a,{className:"test-select-message-item",style:{color:a&&a.username===n?"green":"red"},children:[Object(U.jsxs)("strong",{children:[n," \u2192 ",r,":"]})," ",o]},e.contractId)})),Object(U.jsxs)("h3",{style:{color:(t=c,t<0?"red":"green")},children:["You ",c<=0?"owe":"are owed"," $ ",c,"."]})]})},B=function(e){var t=e.followers,n=Object(_.useParty)(),r=o.a.useState(),a=Object(u.a)(r,2),c=a[0],s=a[1],i=o.a.useState(""),l=Object(u.a)(i,2),f=l[0],m=l[1],b=o.a.useState(!1),p=Object(u.a)(b,2),x=p[0],v=p[1],y=Object(_.useLedger)(),g=function(){var e=Object(j.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.preventDefault(),void 0!==c){e.next=4;break}return e.abrupt("return");case 4:return v(!0),e.next=7,y.exerciseByKey(D.User.User.MakeTransaction,c,{lender:n,amount:f});case 7:m(""),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),alert("Error sending message:\n".concat(JSON.stringify(e.t0)));case 13:return e.prev=13,v(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[0,10,13,16]])})));return function(t){return e.apply(this,arguments)}}();return Object(U.jsxs)(h.a,{onSubmit:g,children:[Object(U.jsx)(h.a.Dropdown,{selection:!0,className:"test-select-message-receiver",placeholder:"Select your friend",options:t.map((function(e){return{key:e,text:e,value:e}})),value:c,onChange:function(e){var t;return s(null!==(t=e.currentTarget.textContent)&&void 0!==t?t:void 0)}}),Object(U.jsx)(h.a.Input,{className:"test-select-message-content",placeholder:"Enter an amount",value:f,onChange:function(e){return m(e.currentTarget.value)}}),Object(U.jsx)(O.a,{fluid:!0,className:"test-select-message-send-button",type:"submit",disabled:x||void 0===c||""===f,loading:x,content:"Send"})]})},H=function(){var e,t,n,r=Object(_.useParty)(),a=null===(e=Object(_.useStreamFetchByKeys)(D.User.User,(function(){return[r]}),[r]).contracts[0])||void 0===e?void 0:e.payload,o=Object(_.useStreamQueries)(D.User.User).contracts,s=Object(c.useMemo)((function(){return o.map((function(e){return e.payload})).filter((function(e){return e.username!==r})).sort((function(e,t){return e.username.localeCompare(t.username)}))}),[o,r]),i=Object(_.useLedger)(),u=function(){var e=Object(j.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.exerciseByKey(D.User.User.Follow,r,{userToFollow:t});case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e.catch(0),alert("Unknown error:\n".concat(e.t0)),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}();return Object(U.jsx)(I.a,{children:Object(U.jsxs)(f.a,{centered:!0,columns:3,children:[Object(U.jsx)(f.a.Row,{stretched:!0,children:Object(U.jsx)(f.a.Column,{children:Object(U.jsx)(m.a,{as:"h1",size:"huge",color:"blue",textAlign:"center",style:{padding:"1ex 0em 0ex 0em"},children:a?"Welcome, ".concat(a.username,"!"):"Loading..."})})}),Object(U.jsxs)(f.a.Row,{stretched:!0,children:[Object(U.jsx)(f.a.Column,{children:Object(U.jsxs)(p.a,{children:[Object(U.jsxs)(m.a,{as:"h2",children:[Object(U.jsx)(T.a,{name:"user"}),Object(U.jsxs)(m.a.Content,{children:[null!==(t=null===a||void 0===a?void 0:a.username)&&void 0!==t?t:"Loading...",Object(U.jsx)(m.a.Subheader,{children:"Users I'm following"})]})]}),Object(U.jsx)(A.a,{}),Object(U.jsx)(z,{parties:null!==(n=null===a||void 0===a?void 0:a.following)&&void 0!==n?n:[],onAddParty:u})]})}),Object(U.jsx)(f.a.Column,{children:Object(U.jsxs)(p.a,{children:[Object(U.jsxs)(m.a,{as:"h2",children:[Object(U.jsx)(T.a,{name:"globe"}),Object(U.jsxs)(m.a.Content,{children:["The Network",Object(U.jsx)(m.a.Subheader,{children:"My followers and users they are following"})]})]}),Object(U.jsx)(A.a,{}),Object(U.jsx)(E,{users:s,onFollow:u})]})}),Object(U.jsx)(f.a.Column,{children:Object(U.jsxs)(p.a,{children:[Object(U.jsxs)(m.a,{as:"h2",children:[Object(U.jsx)(T.a,{name:"pencil square"}),Object(U.jsxs)(m.a.Content,{children:["Transactions",Object(U.jsx)(m.a.Subheader,{children:"Make a transaction with a follower"})]})]}),Object(U.jsx)(B,{followers:s.map((function(e){return e.username}))}),Object(U.jsx)(A.a,{}),Object(U.jsx)(R,{})]})})]})]})})},K=function(e){var t=e.onLogout;return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsxs)(C.a,{icon:!0,borderless:!0,children:[Object(U.jsx)(C.a.Item,{children:Object(U.jsx)(b.a,{as:"a",href:"https://www.daml.com/",target:"_blank",src:"/daml.svg",alt:"DAML Logo",size:"mini"})}),Object(U.jsxs)(C.a.Menu,{position:"right",className:"test-select-main-menu",children:[Object(U.jsxs)(C.a.Item,{position:"right",children:["You are logged in as ",Object(_.useParty)(),"."]}),Object(U.jsx)(C.a.Item,{position:"right",active:!1,className:"test-select-log-out",onClick:t,icon:"log out"})]})]}),Object(U.jsx)(H,{})]})},W=function(){var e=o.a.useState(),t=Object(u.a)(e,2),n=t[0],r=t[1];return n?Object(U.jsx)(L.a,{token:n.token,party:n.party,httpBaseUrl:g,children:Object(U.jsx)(K,{onLogout:function(){return r(void 0)}})}):Object(U.jsx)(M,{onLogin:r})};i.a.render(Object(U.jsx)(W,{}),document.getElementById("root"))}},[[530,1,2]]]);
//# sourceMappingURL=main.177f92d3.chunk.js.map